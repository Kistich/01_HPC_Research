# Phillyå¯¹æ¯”åˆ†ææ¨¡å— (Philly Comparison Module)

## åŠŸèƒ½æè¿°

æœ¬æ¨¡å—åŸºäºHeliosé¡¹ç›®çš„Phillyå¯¹æ¯”åˆ†ææ–¹æ³•ï¼Œ**ä¸¥æ ¼å¤ç°Heliosè®ºæ–‡ä¸­çš„å¯¹æ¯”åˆ†æå›¾è¡¨**ã€‚é€šè¿‡ä¸Microsoft Phillyæ•°æ®é›†çš„å¯¹æ¯”ï¼Œå±•ç¤ºæˆ‘ä»¬HPCé›†ç¾¤ä¸ä¸šç•Œæ ‡å‡†æ·±åº¦å­¦ä¹ å·¥ä½œè´Ÿè½½çš„å·®å¼‚å’Œç‰¹ç‚¹ã€‚**ä¿æŒåŸæœ‰çš„4å¼ å›¾è¾“å‡ºç»“æ„ï¼ŒåŒæ—¶ä½¿ç”¨Helioså…¼å®¹æ•°æ®æ ¼å¼**ã€‚

## ğŸ†• Helioså…¼å®¹ç‰¹æ€§

### **ä½¿ç”¨Helioså…¼å®¹æ•°æ®**
- âœ… **è¾“å…¥æ•°æ®**: ä½¿ç”¨`cluster_log.csv`ç­‰Heliosæ ‡å‡†æ ¼å¼
- âœ… **å­—æ®µæ˜ å°„**: `gpu_num` â†’ GPUæ•°é‡ï¼Œ`state` â†’ ä½œä¸šçŠ¶æ€
- âœ… **æ•°æ®æ ‡å‡†åŒ–**: ç»Ÿä¸€çš„GPUä½œä¸šç­›é€‰å’ŒçŠ¶æ€æ˜ å°„

### **ä¿æŒ4å¼ å›¾ç»“æ„**
- âœ… **å›¾1**: ä½œä¸šç±»å‹åˆ†å¸ƒï¼ˆCPU vs GPU jobsï¼‰
- âœ… **å›¾2**: GPUä½œä¸šçŠ¶æ€æ•°é‡åˆ†å¸ƒ
- âœ… **å›¾3**: GPUä½œä¸šæŒç»­æ—¶é—´CDFå¯¹æ¯”
- âœ… **å›¾4**: GPUæ—¶é—´æŒ‰çŠ¶æ€åˆ†å¸ƒ

## æ ¸å¿ƒç›®æ ‡

### 1. ä¸¥æ ¼å¤ç°Heliosåˆ†æ
- å®Œå…¨æŒ‰ç…§Heliosè®ºæ–‡çš„å¯¹æ¯”æ–¹æ³•
- ç›¸åŒçš„å›¾è¡¨ç±»å‹å’Œå¯è§†åŒ–é£æ ¼
- ä¸€è‡´çš„ç»Ÿè®¡æŒ‡æ ‡å’Œè®¡ç®—æ–¹æ³•

### 2. æ•°æ®é›†å¯¹æ¯”åŸºå‡†
- æä¾›ä¸ä¸šç•Œæ ‡å‡†çš„å¯¹æ¯”åŸºå‡†
- è¯†åˆ«HPCé›†ç¾¤çš„ç‹¬ç‰¹ç‰¹å¾
- éªŒè¯åˆ†ææ–¹æ³•çš„æœ‰æ•ˆæ€§

### 3. æ§åˆ¶å˜é‡åˆ†æ
- å›ºå®šåˆ†ææ–¹æ³•ï¼Œå¯¹æ¯”æ•°æ®å·®å¼‚
- è¯†åˆ«é›†ç¾¤é…ç½®å¯¹å·¥ä½œè´Ÿè½½çš„å½±å“
- ä¸ºé›†ç¾¤ä¼˜åŒ–æä¾›å‚è€ƒ

## ä¸»è¦åŠŸèƒ½

### 1. æ•°æ®æ ¼å¼ç»Ÿä¸€åŒ–
- HPCæ•°æ®æ ‡å‡†åŒ–å¤„ç†
- Phillyæ•°æ®æ ¼å¼é€‚é…
- å­—æ®µæ˜ å°„å’Œç±»å‹è½¬æ¢
- æ•°æ®è´¨é‡ç»Ÿä¸€ä¿è¯

### 2. GPUä½œä¸šæŒç»­æ—¶é—´CDFå¯¹æ¯”
- ä¸¥æ ¼æŒ‰ç…§Heliosæ–¹æ³•è®¡ç®—CDF
- å¯¹æ•°åˆ»åº¦æ—¶é—´è½´ (1ç§’åˆ°2^21ç§’)
- åŒæ•°æ®é›†å¯¹æ¯”å¯è§†åŒ–
- å…³é”®ç™¾åˆ†ä½æ•°æ ‡æ³¨

### 3. GPUæ—¶é—´æŒ‰çŠ¶æ€åˆ†å¸ƒå¯¹æ¯”
- æŒ‰ä½œä¸šçŠ¶æ€åˆ†ç±»GPUæ—¶é—´æ¶ˆè€—
- Completed/Canceled/Failedä¸‰ç±»å¯¹æ¯”
- èµ„æºæµªè´¹ç‡è®¡ç®—
- é›†ç¾¤æ•ˆç‡å¯¹æ¯”åˆ†æ

### 4. æ•°æ®é›†è§„æ¨¡å¯¹æ¯”
- ä½œä¸šæ•°é‡è§„æ¨¡å¯¹æ¯”
- ç”¨æˆ·æ•°é‡å¯¹æ¯”
- èµ„æºéœ€æ±‚å¯¹æ¯”
- æ—¶é—´è·¨åº¦å¯¹æ¯”

## å¯¹æ¯”åˆ†æç»´åº¦

### 1. è§„æ¨¡å¯¹æ¯”
```
æŒ‡æ ‡                HPCé›†ç¾¤        Phillyé›†ç¾¤
æ€»GPUä½œä¸šæ•°         Xä¸‡           Yä¸‡  
è§„æ¨¡æ¯”ä¾‹            Zå€
å¹³å‡æŒç»­æ—¶é—´        Aç§’           Bç§’
æœ€å¤§GPUéœ€æ±‚         C GPU         D GPU
```

### 2. æ•ˆç‡å¯¹æ¯”
```
æŒ‡æ ‡                HPCé›†ç¾¤        Phillyé›†ç¾¤
å®Œæˆç‡              X%            Y%
å–æ¶ˆç‡              A%            B%
å¤±è´¥ç‡              C%            D%
èµ„æºæµªè´¹ç‡          E%            F%
```

### 3. å·¥ä½œè´Ÿè½½ç‰¹å¾å¯¹æ¯”
```
ç‰¹å¾                HPCé›†ç¾¤        Phillyé›†ç¾¤
ä¸­ä½æŒç»­æ—¶é—´        Xå°æ—¶         Yå°æ—¶
95%åˆ†ä½æŒç»­æ—¶é—´     Aå°æ—¶         Bå°æ—¶
å¹³å‡GPUéœ€æ±‚         C GPU         D GPU
æœ€å¤§GPUéœ€æ±‚         E GPU         F GPU
```

## è¾“å‡ºç»“æœ

### å¯è§†åŒ–å›¾è¡¨ (ä¸¥æ ¼Heliosé£æ ¼)
1. `philly_comparison.pdf`: åŒå­å›¾å¯¹æ¯”åˆ†æ
   - å›¾(a): GPUä½œä¸šæŒç»­æ—¶é—´CDFå¯¹æ¯”
   - å›¾(b): GPUæ—¶é—´æŒ‰çŠ¶æ€åˆ†å¸ƒå¯¹æ¯”

### åˆ†æç»“æœ
- `dataset_comparison`: æ•°æ®é›†åŸºæœ¬ä¿¡æ¯å¯¹æ¯”
- `duration_comparison`: æŒç»­æ—¶é—´åˆ†å¸ƒå¯¹æ¯”
- `gpu_time_comparison`: GPUæ—¶é—´çŠ¶æ€åˆ†å¸ƒå¯¹æ¯”

### å¯¹æ¯”æŠ¥å‘Š
- `philly_comparison_report.txt`: è¯¦ç»†å¯¹æ¯”åˆ†ææŠ¥å‘Š

## å…³é”®å‘ç° (åŸºäºHeliosæ–¹æ³•)

### æ•°æ®é›†è§„æ¨¡å·®å¼‚
- HPCæ•°æ®é›†ç›¸å¯¹äºPhillyçš„è§„æ¨¡æ¯”ä¾‹
- ä½œä¸šæ•°é‡å’Œç”¨æˆ·æ•°é‡çš„å·®å¼‚
- èµ„æºéœ€æ±‚è§„æ¨¡çš„å¯¹æ¯”

### å·¥ä½œè´Ÿè½½ç‰¹å¾å·®å¼‚
- ä½œä¸šæŒç»­æ—¶é—´åˆ†å¸ƒçš„å·®å¼‚
- GPUèµ„æºéœ€æ±‚æ¨¡å¼çš„ä¸åŒ
- ä½œä¸šæˆåŠŸç‡å’Œå¤±è´¥æ¨¡å¼çš„å¯¹æ¯”

### é›†ç¾¤æ•ˆç‡å·®å¼‚
- èµ„æºæµªè´¹ç‡çš„å¯¹æ¯”
- è°ƒåº¦æ•ˆç‡çš„å·®å¼‚
- ç³»ç»Ÿç¨³å®šæ€§çš„å¯¹æ¯”

## æŠ€æœ¯å®ç°

### 1. æ•°æ®æ ‡å‡†åŒ–
```python
def standardize_hpc_data(hpc_data):
    """æ ‡å‡†åŒ–HPCæ•°æ®æ ¼å¼"""
    # çŠ¶æ€æ˜ å°„åˆ°Phillyæ ¼å¼
    status_mapping = {
        'COMPLETED': 'Pass',
        'CANCELLED': 'Killed', 
        'FAILED': 'Failed'
    }
    # ç­›é€‰GPUä½œä¸š
    gpu_jobs = data[data['gpu_num'] > 0]
    return gpu_jobs
```

### 2. CDFè®¡ç®— (Heliosæ–¹æ³•)
```python
def calculate_duration_cdf():
    """è®¡ç®—æŒç»­æ—¶é—´CDF"""
    time_points = [2**i for i in range(0, 22)]  # 1ç§’åˆ°2^21ç§’
    for t in time_points:
        ratio = len(data[data['duration'] <= t]) / len(data) * 100
        job_ratios.append(ratio)
```

### 3. GPUæ—¶é—´åˆ†å¸ƒè®¡ç®—
```python
def calculate_gpu_time_by_status():
    """è®¡ç®—GPUæ—¶é—´æŒ‰çŠ¶æ€åˆ†å¸ƒ"""
    total_gpu_time = (data['gpu_num'] * data['duration']).sum()
    for status in ['Pass', 'Killed', 'Failed']:
        status_data = data[data['state'] == status]
        gpu_time = (status_data['gpu_num'] * status_data['duration']).sum()
        percentage = gpu_time / total_gpu_time * 100
```

## ä½¿ç”¨æ–¹æ³•

```python
from modules.01_philly_comparison.philly_comparison_analyzer import PhillyComparisonAnalyzer

# åˆå§‹åŒ–åˆ†æå™¨
analyzer = PhillyComparisonAnalyzer(config, output_paths, visualizer)

# æ‰§è¡Œå¯¹æ¯”åˆ†æ
results = analyzer.analyze(processed_data)

# ç”Ÿæˆå¯¹æ¯”æŠ¥å‘Š
report = analyzer.generate_comparison_report(results)
```

## é…ç½®è¦æ±‚

éœ€è¦åœ¨ `analysis_config.yaml` ä¸­å¯ç”¨ï¼š
```yaml
modules:
  philly_comparison:
    enabled: true
```

## æ•°æ®è¦æ±‚

### HPCæ•°æ®è¦æ±‚
- `gpu_num`: GPUæ•°é‡ï¼ˆå¿…éœ€ï¼‰
- `duration`: ä½œä¸šæŒç»­æ—¶é—´ï¼ˆå¿…éœ€ï¼‰
- `job_status_standardized`: æ ‡å‡†åŒ–ä½œä¸šçŠ¶æ€ï¼ˆå¿…éœ€ï¼‰
- `user_id`: ç”¨æˆ·æ ‡è¯†ï¼ˆå¯é€‰ï¼‰

### Phillyæ•°æ®æ ¼å¼
```csv
jobname,vc,user,state,submit_time,start_time,end_time,gpu_num,duration,queue
```

## æ•°æ®æº

### Phillyæ•°æ®é›†
- æ¥æº: Microsoft Phillyé›†ç¾¤
- ä½ç½®: `data/external/philly_trace.csv`
- è§„æ¨¡: çº¦10ä¸‡GPUä½œä¸š
- æ—¶é—´è·¨åº¦: 2017å¹´æ•°æ®

### HPCæ•°æ®é›†
- æ¥æº: é¦™æ¸¯å¤§å­¦HPCé›†ç¾¤
- ä½ç½®: é¢„å¤„ç†åçš„æ•°æ®
- è§„æ¨¡: çº¦Xä¸‡GPUä½œä¸š
- æ—¶é—´è·¨åº¦: 2024å¹´æ•°æ®

## åˆ†æä»·å€¼

### 1. å­¦æœ¯ä»·å€¼
- éªŒè¯Heliosåˆ†ææ–¹æ³•çš„é€šç”¨æ€§
- æä¾›ä¸åŒç±»å‹é›†ç¾¤çš„å¯¹æ¯”åŸºå‡†
- ä¸ºHPCå·¥ä½œè´Ÿè½½ç ”ç©¶æä¾›æ•°æ®æ”¯æ’‘

### 2. å·¥ç¨‹ä»·å€¼
- è¯†åˆ«HPCé›†ç¾¤çš„ä¼˜åŒ–ç©ºé—´
- å¯¹æ¯”ä¸šç•Œæœ€ä½³å®è·µ
- ä¸ºé›†ç¾¤é…ç½®æä¾›å‚è€ƒ

### 3. æ–¹æ³•è®ºä»·å€¼
- å±•ç¤ºæ ‡å‡†åŒ–å¯¹æ¯”åˆ†ææ–¹æ³•
- æä¾›å¯å¤ç°çš„åˆ†ææµç¨‹
- å»ºç«‹å·¥ä½œè´Ÿè½½å¯¹æ¯”åŸºå‡†

## å±€é™æ€§å’Œæ³¨æ„äº‹é¡¹

### 1. æ—¶é—´å·®å¼‚
- HPCæ•°æ®(2024å¹´) vs Phillyæ•°æ®(2017å¹´)
- ç¡¬ä»¶æŠ€æœ¯å‘å±•çš„å½±å“
- å·¥ä½œè´Ÿè½½æ¨¡å¼çš„æ¼”è¿›

### 2. é›†ç¾¤ç±»å‹å·®å¼‚
- HPCé€šç”¨è®¡ç®— vs ä¸“ç”¨æ·±åº¦å­¦ä¹ é›†ç¾¤
- ç”¨æˆ·ç¾¤ä½“å’Œåº”ç”¨åœºæ™¯çš„ä¸åŒ
- è°ƒåº¦ç­–ç•¥å’Œç®¡ç†æ–¹å¼çš„å·®å¼‚

### 3. æ•°æ®å®Œæ•´æ€§
- ä¸åŒæ•°æ®æ”¶é›†æ–¹æ³•
- å­—æ®µå®šä¹‰çš„å·®å¼‚
- æ•°æ®è´¨é‡çš„ä¸åŒ

## æ‰©å±•æ–¹å‘

### 1. æ›´å¤šæ•°æ®é›†å¯¹æ¯”
- æ·»åŠ å…¶ä»–å…¬å¼€æ•°æ®é›†
- å¤šé›†ç¾¤å¯¹æ¯”åˆ†æ
- æ—¶é—´åºåˆ—å¯¹æ¯”

### 2. æ›´æ·±å…¥çš„åˆ†æ
- ç”¨æˆ·è¡Œä¸ºå¯¹æ¯”
- åº”ç”¨ç±»å‹å¯¹æ¯”
- æ€§èƒ½æŒ‡æ ‡å¯¹æ¯”

### 3. åŠ¨æ€å¯¹æ¯”
- å®æ—¶å¯¹æ¯”åˆ†æ
- è¶‹åŠ¿å˜åŒ–å¯¹æ¯”
- é¢„æµ‹æ€§å¯¹æ¯”

## æœ€æ–°æ›´æ–° (2025-09-03)

### å¯è§†åŒ–å›¾è¡¨æ›´æ–°
ç°åœ¨ç”Ÿæˆ4ä¸ªç‹¬ç«‹çš„Heliosé£æ ¼å›¾è¡¨ï¼Œè€Œä¸æ˜¯2x2å­å›¾å¸ƒå±€ï¼š

1. **ä½œä¸šç±»å‹åˆ†å¸ƒå›¾** (`job_type_distribution.png`)
   - CPU vs GPUä½œä¸šå æ¯”çš„å †å æŸ±çŠ¶å›¾
   - æ˜¾ç¤ºHPC vs Phillyçš„ä½œä¸šç±»å‹å·®å¼‚

2. **GPUä½œä¸šçŠ¶æ€æ•°é‡åˆ†å¸ƒå›¾** (`gpu_job_count_status.png`)
   - GPUä½œä¸šæŒ‰çŠ¶æ€(Complete/Failed/Canceled)çš„æ•°é‡åˆ†å¸ƒ
   - åˆ†ç»„æŸ±çŠ¶å›¾æ˜¾ç¤ºä½œä¸šæˆåŠŸç‡å¯¹æ¯”

3. **GPUä½œä¸šæŒç»­æ—¶é—´CDFå›¾** (`gpu_duration_cdf.png`)
   - ä¸¥æ ¼æŒ‰ç…§Helios Figure 2(a)å®ç°
   - å¯¹æ•°åæ ‡ï¼Œæ—¶é—´èŒƒå›´1ç§’åˆ°2^21ç§’

4. **GPUæ—¶é—´åˆ†å¸ƒå›¾** (`gpu_time_status.png`)
   - ä¸¥æ ¼æŒ‰ç…§Helios Figure 2(b)å®ç°
   - GPUæ—¶é—´æŒ‰çŠ¶æ€åˆ†å¸ƒçš„ç™¾åˆ†æ¯”

### GPUä½œä¸šè¯†åˆ«æ”¹è¿›
- åŸºäº`exec_hosts`å­—æ®µè¯†åˆ«GPUä½œä¸šï¼Œè€Œä¸ä»…ä¾èµ–`gpu_num`
- æé«˜äº†GPUä½œä¸šè¯†åˆ«çš„å‡†ç¡®æ€§
- å¢åŠ äº†18,622æ¡GPUä½œä¸š(+17.7%)

### è¾“å‡ºç›®å½•ç»“æ„
- æ‰€æœ‰å›¾è¡¨ä¿å­˜åœ¨æ¨¡å—åŒ–ç›®å½•ï¼š`outputs/figures/philly_comparison/`
- æŠ¥å‘Šä¿å­˜åœ¨ï¼š`outputs/reports/philly_comparison/`
